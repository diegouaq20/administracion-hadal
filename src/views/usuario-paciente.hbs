<head>
    <title>Pacientes</title>
    <link rel="stylesheet" href="/main-edit.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
    <script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
</head>

<body>
    <h1>Pacientes</h1>
    <div class="filter-container">
        <label for="categoryFilter">Filtrar por acceso:</label>
        <select id="categoryFilter" onchange="filterTableByCategory()">
            <option value="">Todas</option>
            <option value="bloqueado">Bloqueado</option>
            <option value="desbloqueado">Permitido</option>
        </select>
    </div>

    <table id="miTabla" class="table table-container">
        <thead>
            <tr>
                <th>Foto</th>
                <th>ID</th>
                <th>Nombre</th>
                <th>Email</th>
                <th>Acceso</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {{#each allUsers}}
            <tr data-category="{{this.userData.acceso}}">
                <td><img class="imagen-usuario" src="{{this.userData.photoUrl}}" alt="Foto de {{this.id}}" width="50">
                </td>
                <td><a href="/usuario-paciente/{{id}}">{{id}}</a></td>
                <td>{{this.userData.nombre}} {{this.userData.primerApellido}} {{this.userData.segundoApellido}}</td>
                <td>{{this.userData.email}}</td>
                <td>
                    {{#ifCond this.userData.acceso '===' 'desbloqueado'}}
                    Permitido
                    {{else}}
                    Bloqueado
                    {{/ifCond}}
                </td>

                <td>
                    <a href="/usuario-paciente/{{id}}">Ver</a>
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>


    <script>
//Filtro por categoria
        function filterTableByCategory() {
            const select = document.getElementById('categoryFilter');
            const selectedCategory = select.value;
            const table = document.querySelector('.table');
            const rows = table.getElementsByTagName('tr');

            for (let i = 1; i < rows.length; i++) {
                const category = rows[i].getAttribute('data-category');
                if (selectedCategory === '' || category === selectedCategory) {
                    rows[i].style.display = '';
                } else {
                    rows[i].style.display = 'none';
                }
            }
        }

//Datatables
        $(document).ready(function () {
            $('#miTabla').DataTable({
                "paging": true,    // Habilita la paginación
                "pageLength": 10,  // Número de filas por página
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json',
                },
                // Puedes personalizar otras opciones aquí según tus necesidades
            });
        });
    </script>
</body>